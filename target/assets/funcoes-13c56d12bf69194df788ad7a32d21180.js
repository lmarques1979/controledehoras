$(document).ready(function(){function n(e){$("#container").highcharts({chart:{type:"line",backgroundColor:"#fbf5ef"},title:{text:"Horas do Mes "+e["mes"]+" de "+e["ano"]+" ("+document.getElementById("totalgeral").value+")",margin:50},subtitle:{text:""},xAxis:{categories:e["dias"],title:{text:"Dia do Mes"}},yAxis:{title:{text:"Quantidade Horas (dia)"},gridLineWidth:0,tickInterval:.1},plotOptions:{line:{dataLabels:{enabled:true},enableMouseTracking:false}},series:[{name:e["usuario"],data:e["totaldia"],dataLabels:{enabled:true,rotation:-90,color:"#000",align:"top",x:4,y:-10,style:{fontSize:"11px",fontFamily:"Verdana, sans-serif",textShadow:"0 0 3px #fff"}}}]})}function r(){var e=$("#formupdate").attr("action");i(e)}function i(e,t){var r=$("#formupdate").serializeArray();var i=e;$.ajax({url:i,type:"POST",data:r,dataType:"json",success:function(t,r,i){var s=0;var o=0;var u=[];var a=[];var f=[];while(o<t.horas.length){var l="totaldia"+t.horas[o].id;var c=t.horas[o].totaldia.toFixed(3).replace(".",",");var h=t.horas[o].totaliza;if(h=="1"){document.getElementById(l).value=c;s=s+t.horas[o].totaldia;a.push(t.horas[o].dia);f.push(t.horas[o].totaldia)}else{document.getElementById(l).value="0,000"}o++}u["mes"]=t.horas[0].mes;u["ano"]=t.horas[0].ano;u["usuario"]=t.usuario;u["dias"]=a;u["totaldia"]=f;document.getElementById("totalgeral").value=s.toFixed(3).replace(".",",");if(e!=="/controledehoras/horas/atualizatotal"){var p='<div class="message" role="status">Horario Salvo</div>'}$(".ajaxmessage").html("");$(".ajaxerror").html("");$(".ajaxmessage").html(p);n(u)},error:function(e,t,n){var r=0;var i='<ul class="errors" role="alert">';var s="";var o="</div>";while(r<e.responseJSON.length){s=s+"<li>"+e.responseJSON[r]+"</li>";r++}var u=i+s+o;$(".ajaxmessage").html("");$(".ajaxerror").html("");$(".ajaxerror").html(u)}});t.preventDefault()}var e=$("#formupdate").serializeArray();var t="/controledehoras/horas/atualizatotal";$.ajax({url:t,type:"POST",data:e,dataType:"json",success:function(e,t,r){var i=0;var s=0;var o=[];var u=[];var a=[];while(s<e.horas.length){var f="totaldia"+e.horas[s].id;var l=e.horas[s].totaldia.toFixed(3).replace(".",",");var c=e.horas[s].totaliza;if(c=="1"){document.getElementById(f).value=l;i=i+e.horas[s].totaldia;u.push(e.horas[s].dia);a.push(e.horas[s].totaldia)}else{document.getElementById(f).value=0}s++}o["mes"]=e.horas[0].mes;o["ano"]=e.horas[0].ano;o["usuario"]=e.usuario;o["dias"]=u;o["totaldia"]=a;document.getElementById("totalgeral").value=i.toFixed(3).replace(".",",");n(o)},error:function(e,t,n){var r=0;var i='<ul class="errors" role="alert">';var s="";var o="</div>";while(r<e.responseJSON.length){s=s+"<li>"+e.responseJSON[r]+"</li>";r++}var u=i+s+o;$(".ajaxmessage").html("");$(".ajaxerror").html("");$(".ajaxerror").html(u)}});$(".totaliza").click(function(){var e=$(this).attr("data-idfoto");var t="#totalizahidden"+e;var n=$(this).closest("tr").find(t);if($(this).is(":checked")){n.val("1")}else{n.val("0")}r()});$("#formupdatesubmit").click(function(e){var t=$("#formupdate").attr("action");i(t,e)});$(".timeentry").blur(function(e){var t="/controledehoras/horas/atualizatotal";i(t,e)})})