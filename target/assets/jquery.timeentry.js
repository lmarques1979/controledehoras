(function(e){function t(){this._disabledInputs=[];this.regional=[];this.regional[""]={show24Hours:false,separator:":",ampmPrefix:"",ampmNames:["AM","PM"],spinnerTexts:["Hora Atual","Anterior","Prï¿½ximo","Incrementar","Decrementar"]};this._defaults={appendText:"",showSeconds:false,timeSteps:[1,1,1],initialField:0,noSeparatorEntry:false,useMouseWheel:true,defaultTime:null,minTime:null,maxTime:null,spinnerImage:"spinnerDefault.png",spinnerSize:[20,20,8],spinnerBigImage:"",spinnerBigSize:[40,40,16],spinnerIncDecOnly:false,spinnerRepeat:[500,250],beforeShow:null,beforeSetTime:null};e.extend(this._defaults,this.regional[""])}function r(t,r){if(t=="option"&&(r.length==0||r.length==1&&typeof r[0]=="string")){return true}return e.inArray(t,n)>-1}e.extend(t.prototype,{markerClassName:"hasTimeEntry",propertyName:"timeEntry",_appendClass:"timeEntry_append",_controlClass:"timeEntry_control",_expandClass:"timeEntry_expand",setDefaults:function(t){e.extend(this._defaults,t||{});return this},_attachPlugin:function(t,n){var r=e(t);if(r.hasClass(this.markerClassName)){return}var s={options:e.extend({},this._defaults,n),input:r,_field:0,_selectedHour:0,_selectedMinute:0,_selectedSecond:0};r.data(this.propertyName,s).addClass(this.markerClassName).bind("focus."+this.propertyName,this._doFocus).bind("blur."+this.propertyName,this._doBlur).bind("click."+this.propertyName,this._doClick).bind("keydown."+this.propertyName,this._doKeyDown).bind("keypress."+this.propertyName,this._doKeyPress).bind("paste."+this.propertyName,function(e){setTimeout(function(){i._parseTime(s)},1)});this._optionPlugin(t,n)},_optionPlugin:function(t,n,r){t=e(t);var i=t.data(this.propertyName);if(!n||typeof n=="string"&&r==null){var s=n;n=(i||{}).options;return n&&s?n[s]:n}if(!t.hasClass(this.markerClassName)){return}n=n||{};if(typeof n=="string"){var s=n;n={};n[s]=r}var o=this._extractTime(i);e.extend(i.options,n);i._field=0;if(o){this._setTime(i,new Date(0,0,0,o[0],o[1],o[2]))}t.next("span."+this._appendClass).remove();t.parent().find("span."+this._controlClass).remove();if(e.fn.mousewheel){t.unmousewheel()}var u=!i.options.spinnerImage?null:e('<span class="'+this._controlClass+'" style="display: inline-block; '+"background: url('"+i.options.spinnerImage+"') 0 0 no-repeat; width: "+i.options.spinnerSize[0]+"px; height: "+i.options.spinnerSize[1]+'px;"></span>');t.after(i.options.appendText?'<span class="'+this._appendClass+'">'+i.options.appendText+"</span>":"").after(u||"");if(i.options.useMouseWheel&&e.fn.mousewheel){t.mousewheel(this._doMouseWheel)}if(u){u.mousedown(this._handleSpinner).mouseup(this._endSpinner).mouseover(this._expandSpinner).mouseout(this._endSpinner).mousemove(this._describeSpinner)}},_enablePlugin:function(e){this._enableDisable(e,false)},_disablePlugin:function(e){this._enableDisable(e,true)},_enableDisable:function(t,n){var r=e.data(t,this.propertyName);if(!r){return}t.disabled=n;if(t.nextSibling&&t.nextSibling.nodeName.toLowerCase()=="span"){i._changeSpinner(r,t.nextSibling,n?5:-1)}i._disabledInputs=e.map(i._disabledInputs,function(e){return e==t?null:e});if(n){i._disabledInputs.push(t)}},_isDisabledPlugin:function(t){return e.inArray(t,this._disabledInputs)>-1},_destroyPlugin:function(t){t=e(t);if(!t.hasClass(this.markerClassName)){return}t.removeClass(this.markerClassName).removeData(this.propertyName).unbind("."+this.propertyName);if(e.fn.mousewheel){t.unmousewheel()}this._disabledInputs=e.map(this._disabledInputs,function(e){return e==t[0]?null:e});t.siblings("."+this._appendClass+",."+this._controlClass).remove()},_setTimePlugin:function(t,n){var r=e.data(t,this.propertyName);if(r){if(n===null||n===""){r.input.val("")}else{this._setTime(r,n?typeof n=="object"?new Date(n.getTime()):n:null)}}},_getTimePlugin:function(t){var n=e.data(t,this.propertyName);var r=n?this._extractTime(n):null;return!r?null:new Date(0,0,0,r[0],r[1],r[2])},_getOffsetPlugin:function(t){var n=e.data(t,this.propertyName);var r=n?this._extractTime(n):null;return!r?0:(r[0]*3600+r[1]*60+r[2])*1e3},_doFocus:function(t){var n=t.nodeName&&t.nodeName.toLowerCase()=="input"?t:this;if(i._lastInput==n||i._isDisabledPlugin(n)){i._focussed=false;return}var r=e.data(n,i.propertyName);i._focussed=true;i._lastInput=n;i._blurredInput=null;e.extend(r.options,e.isFunction(r.options.beforeShow)?r.options.beforeShow.apply(n,[n]):{});i._parseTime(r);setTimeout(function(){i._showField(r)},10)},_doBlur:function(e){i._blurredInput=i._lastInput;i._lastInput=null},_doClick:function(t){var n=t.target;var r=e.data(n,i.propertyName);if(!i._focussed){var s=r.options.separator.length+2;r._field=0;if(n.selectionStart!=null){for(var o=0;o<=Math.max(1,r._secondField,r._ampmField);o++){var u=o!=r._ampmField?o*s+2:r._ampmField*s+r.options.ampmPrefix.length+r.options.ampmNames[0].length;r._field=o;if(n.selectionStart<u){break}}}else if(n.createTextRange){var a=e(t.srcElement);var f=n.createTextRange();var l=function(e){return{thin:2,medium:4,thick:6}[e]||e};var c=t.clientX+document.documentElement.scrollLeft-(a.offset().left+parseInt(l(a.css("border-left-width")),10))-f.offsetLeft;for(var o=0;o<=Math.max(1,r._secondField,r._ampmField);o++){var u=o!=r._ampmField?o*s+2:r._ampmField*s+r.options.ampmPrefix.length+r.options.ampmNames[0].length;f.collapse();f.moveEnd("character",u);r._field=o;if(c<f.boundingWidth){break}}}}i._showField(r);i._focussed=false},_doKeyDown:function(t){if(t.keyCode>=48){return true}var n=e.data(t.target,i.propertyName);switch(t.keyCode){case 9:return t.shiftKey?i._changeField(n,-1,true):i._changeField(n,+1,true);case 35:if(t.ctrlKey){i._setValue(n,"")}else{n._field=Math.max(1,n._secondField,n._ampmField);i._adjustField(n,0)}break;case 36:if(t.ctrlKey){i._setTime(n)}else{n._field=0;i._adjustField(n,0)}break;case 37:i._changeField(n,-1,false);break;case 38:i._adjustField(n,+1);break;case 39:i._changeField(n,+1,false);break;case 40:i._adjustField(n,-1);break;case 46:i._setValue(n,"");break;default:return true}return false},_doKeyPress:function(t){var n=String.fromCharCode(t.charCode==undefined?t.keyCode:t.charCode);if(n<" "){return true}var r=e.data(t.target,i.propertyName);i._handleKeyPress(r,n);return false},_doMouseWheel:function(t,n){if(i._isDisabledPlugin(t.target)){return}var r=e.data(t.target,i.propertyName);r.input.focus();if(!r.input.val()){i._parseTime(r)}i._adjustField(r,n);t.preventDefault()},_expandSpinner:function(t){var n=i._getSpinnerTarget(t);var r=e.data(i._getInput(n),i.propertyName);if(i._isDisabledPlugin(r.input[0])){return}if(r.options.spinnerBigImage){r._expanded=true;var s=e(n).offset();var o=null;e(n).parents().each(function(){var t=e(this);if(t.css("position")=="relative"||t.css("position")=="absolute"){o=t.offset()}return!o});e('<div class="'+i._expandClass+'" style="position: absolute; left: '+(s.left-(r.options.spinnerBigSize[0]-r.options.spinnerSize[0])/2-(o?o.left:0))+"px; top: "+(s.top-(r.options.spinnerBigSize[1]-r.options.spinnerSize[1])/2-(o?o.top:0))+"px; width: "+r.options.spinnerBigSize[0]+"px; height: "+r.options.spinnerBigSize[1]+"px; background: transparent url("+r.options.spinnerBigImage+') no-repeat 0px 0px; z-index: 10;"></div>').mousedown(i._handleSpinner).mouseup(i._endSpinner).mouseout(i._endExpand).mousemove(i._describeSpinner).insertAfter(n)}},_getInput:function(t){return e(t).siblings("."+i.markerClassName)[0]},_describeSpinner:function(t){var n=i._getSpinnerTarget(t);var r=e.data(i._getInput(n),i.propertyName);n.title=r.options.spinnerTexts[i._getSpinnerRegion(r,t)]},_handleSpinner:function(t){var n=i._getSpinnerTarget(t);var r=i._getInput(n);if(i._isDisabledPlugin(r)){return}if(r==i._blurredInput){i._lastInput=r;i._blurredInput=null}var s=e.data(r,i.propertyName);i._doFocus(r);var o=i._getSpinnerRegion(s,t);i._changeSpinner(s,n,o);i._actionSpinner(s,o);i._timer=null;i._handlingSpinner=true;if(o>=3&&s.options.spinnerRepeat[0]){i._timer=setTimeout(function(){i._repeatSpinner(s,o)},s.options.spinnerRepeat[0]);e(n).one("mouseout",i._releaseSpinner).one("mouseup",i._releaseSpinner)}},_actionSpinner:function(e,t){if(!e.input.val()){i._parseTime(e)}switch(t){case 0:this._setTime(e);break;case 1:this._changeField(e,-1,false);break;case 2:this._changeField(e,+1,false);break;case 3:this._adjustField(e,+1);break;case 4:this._adjustField(e,-1);break}},_repeatSpinner:function(e,t){if(!i._timer){return}i._lastInput=i._blurredInput;this._actionSpinner(e,t);this._timer=setTimeout(function(){i._repeatSpinner(e,t)},e.options.spinnerRepeat[1])},_releaseSpinner:function(e){clearTimeout(i._timer);i._timer=null},_endExpand:function(t){i._timer=null;var n=i._getSpinnerTarget(t);var r=i._getInput(n);var s=e.data(r,i.propertyName);e(n).remove();s._expanded=false},_endSpinner:function(t){i._timer=null;var n=i._getSpinnerTarget(t);var r=i._getInput(n);var s=e.data(r,i.propertyName);if(!i._isDisabledPlugin(r)){i._changeSpinner(s,n,-1)}if(i._handlingSpinner){i._lastInput=i._blurredInput}if(i._lastInput&&i._handlingSpinner){i._showField(s)}i._handlingSpinner=false},_getSpinnerTarget:function(e){return e.target||e.srcElement},_getSpinnerRegion:function(t,n){var r=this._getSpinnerTarget(n);var i=e(r).offset();var s=[document.documentElement.scrollLeft||document.body.scrollLeft,document.documentElement.scrollTop||document.body.scrollTop];var o=t.options.spinnerIncDecOnly?99:n.clientX+s[0]-i.left;var u=n.clientY+s[1]-i.top;var a=t.options[t._expanded?"spinnerBigSize":"spinnerSize"];var f=t.options.spinnerIncDecOnly?99:a[0]-1-o;var l=a[1]-1-u;if(a[2]>0&&Math.abs(o-f)<=a[2]&&Math.abs(u-l)<=a[2]){return 0}var c=Math.min(o,u,f,l);return c==o?1:c==f?2:c==u?3:4},_changeSpinner:function(t,n,r){e(n).css("background-position","-"+(r+1)*t.options[t._expanded?"spinnerBigSize":"spinnerSize"][0]+"px 0px")},_parseTime:function(e){var t=this._extractTime(e);if(t){e._selectedHour=t[0];e._selectedMinute=t[1];e._selectedSecond=t[2]}else{var n=this._constrainTime(e);e._selectedHour=n[0];e._selectedMinute=n[1];e._selectedSecond=e.options.showSeconds?n[2]:0}e._secondField=e.options.showSeconds?2:-1;e._ampmField=e.options.show24Hours?-1:e.options.showSeconds?3:2;e._lastChr="";e._field=Math.max(0,Math.min(Math.max(1,e._secondField,e._ampmField),e.options.initialField));if(e.input.val()!=""){this._showTime(e)}},_extractTime:function(e,t){t=t||e.input.val();var n=t.split(e.options.separator);if(e.options.separator==""&&t!=""){n[0]=t.substring(0,2);n[1]=t.substring(2,4);n[2]=t.substring(4,6)}if(n.length>=2){var r=!e.options.show24Hours&&t.indexOf(e.options.ampmNames[0])>-1;var i=!e.options.show24Hours&&t.indexOf(e.options.ampmNames[1])>-1;var s=parseInt(n[0],10);s=isNaN(s)?0:s;s=((r||i)&&s==12?0:s)+(i?12:0);var o=parseInt(n[1],10);o=isNaN(o)?0:o;var u=n.length>=3?parseInt(n[2],10):0;u=isNaN(u)||!e.options.showSeconds?0:u;return this._constrainTime(e,[s,o,u])}return null},_constrainTime:function(e,t){var n=t!=null;if(!n){var r=this._determineTime(e.options.defaultTime,e)||new Date;t=[r.getHours(),r.getMinutes(),r.getSeconds()]}var i=false;for(var s=0;s<e.options.timeSteps.length;s++){if(i){t[s]=0}else if(e.options.timeSteps[s]>1){t[s]=Math.round(t[s]/e.options.timeSteps[s])*e.options.timeSteps[s];i=true}}return t},_showTime:function(e){var t=this._formatNumber(e.options.show24Hours?e._selectedHour:(e._selectedHour+11)%12+1)+e.options.separator+this._formatNumber(e._selectedMinute)+(e.options.showSeconds?e.options.separator+this._formatNumber(e._selectedSecond):"")+(e.options.show24Hours?"":e.options.ampmPrefix+e.options.ampmNames[e._selectedHour<12?0:1]);this._setValue(e,t);this._showField(e)},_showField:function(e){var t=e.input[0];if(e.input.is(":hidden")||i._lastInput!=t){return}var n=e.options.separator.length+2;var r=e._field!=e._ampmField?e._field*n:e._ampmField*n-e.options.separator.length+e.options.ampmPrefix.length;var s=r+(e._field!=e._ampmField?2:e.options.ampmNames[0].length);if(t.setSelectionRange){t.setSelectionRange(r,s)}else if(t.createTextRange){var o=t.createTextRange();o.moveStart("character",r);o.moveEnd("character",s-e.input.val().length);o.select()}if(!t.disabled){t.focus()}},_formatNumber:function(e){return(e<10?"0":"")+e},_setValue:function(e,t){if(t!=e.input.val()){e.input.val(t).trigger("change")}},_changeField:function(e,t,n){var r=e.input.val()==""||e._field==(t==-1?0:Math.max(1,e._secondField,e._ampmField));if(!r){e._field+=t}this._showField(e);e._lastChr="";return r&&n},_adjustField:function(e,t){if(e.input.val()==""){t=0}this._setTime(e,new Date(0,0,0,e._selectedHour+(e._field==0?t*e.options.timeSteps[0]:0)+(e._field==e._ampmField?t*12:0),e._selectedMinute+(e._field==1?t*e.options.timeSteps[1]:0),e._selectedSecond+(e._field==e._secondField?t*e.options.timeSteps[2]:0)))},_setTime:function(t,n){n=this._determineTime(n,t);var r=this._constrainTime(t,n?[n.getHours(),n.getMinutes(),n.getSeconds()]:null);n=new Date(0,0,0,r[0],r[1],r[2]);var n=this._normaliseTime(n);var i=this._normaliseTime(this._determineTime(t.options.minTime,t));var s=this._normaliseTime(this._determineTime(t.options.maxTime,t));n=i&&n<i?i:s&&n>s?s:n;if(e.isFunction(t.options.beforeSetTime)){n=t.options.beforeSetTime.apply(t.input[0],[this._getTimePlugin(t.input[0]),n,i,s])}t._selectedHour=n.getHours();t._selectedMinute=n.getMinutes();t._selectedSecond=n.getSeconds();this._showTime(t)},_determineTime:function(e,t){var n=function(e){var t=new Date;t.setTime(t.getTime()+e*1e3);return t};var r=function(e){var n=i._extractTime(t,e);var r=new Date;var s=n?n[0]:r.getHours();var o=n?n[1]:r.getMinutes();var u=n?n[2]:r.getSeconds();if(!n){var a=/([+-]?[0-9]+)\s*(s|S|m|M|h|H)?/g;var f=a.exec(e);while(f){switch(f[2]||"s"){case"s":case"S":u+=parseInt(f[1],10);break;case"m":case"M":o+=parseInt(f[1],10);break;case"h":case"H":s+=parseInt(f[1],10);break}f=a.exec(e)}}r=new Date(0,0,10,s,o,u,0);if(/^!/.test(e)){if(r.getDate()>10){r=new Date(0,0,10,23,59,59)}else if(r.getDate()<10){r=new Date(0,0,10,0,0,0)}}return r};return e?typeof e=="string"?r(e):typeof e=="number"?n(e):e:null},_normaliseTime:function(e){if(!e){return null}e.setFullYear(1900);e.setMonth(0);e.setDate(0);return e},_handleKeyPress:function(e,t){if(t==e.options.separator){this._changeField(e,+1,false)}else if(t>="0"&&t<="9"){var n=parseInt(t,10);var r=parseInt(e._lastChr+t,10);var i=e._field!=0?e._selectedHour:e.options.show24Hours?r<24?r:n:(r>=1&&r<=12?r:n>0?n:e._selectedHour)%12+(e._selectedHour>=12?12:0);var s=e._field!=1?e._selectedMinute:r<60?r:n;var o=e._field!=e._secondField?e._selectedSecond:r<60?r:n;var u=this._constrainTime(e,[i,s,o]);this._setTime(e,new Date(0,0,0,u[0],u[1],u[2]));if(e.options.noSeparatorEntry&&e._lastChr){this._changeField(e,+1,false)}else{e._lastChr=t}}else if(!e.options.show24Hours){t=t.toLowerCase();if(t==e.options.ampmNames[0].substring(0,1).toLowerCase()&&e._selectedHour>=12||t==e.options.ampmNames[1].substring(0,1).toLowerCase()&&e._selectedHour<12){var a=e._field;e._field=e._ampmField;this._adjustField(e,+1);e._field=a;this._showField(e)}}}});var n=["getOffset","getTime","isDisabled"];e.fn.timeEntry=function(t){var n=Array.prototype.slice.call(arguments,1);if(r(t,n)){return i["_"+t+"Plugin"].apply(i,[this[0]].concat(n))}return this.each(function(){if(typeof t=="string"){if(!i["_"+t+"Plugin"]){throw"Unknown command: "+t}i["_"+t+"Plugin"].apply(i,[this].concat(n))}else{var r=e.fn.metadata?e(this).metadata():{};i._attachPlugin(this,e.extend({},r,t||{}))}})};var i=e.timeEntry=new t})(jQuery)